name: New Issue Labeler
on:
  issues:
    types: [opened]

permissions:
  contents: read
  issues: write

jobs:
  guard:
    runs-on: ubuntu-latest
    steps:
      - name: Label by user type
        uses: actions/github-script@v7
        with:
          script: |
            const assoc = context.payload.issue.author_association;
            const currentLabels = (context.payload.issue.labels || []).map(l => l.name);

            let label = null;

            if (["MEMBER","OWNER"].includes(assoc)) {
              core.info("Internal org member/owner detected â€” no label.");
            } else if (assoc === "COLLABORATOR") {
              label = "collab-issue";
            } else {
              label = "ext-issue";
            }

            if (label && !currentLabels.includes(label)) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                labels: [label]
              });
              core.info(`Applied label: ${label}`);
            }

